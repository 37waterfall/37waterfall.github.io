<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/icon16.png?v=2.6.2" type="image/png" sizes="16x16"><link rel="icon" href="/favicon32.png?v=2.6.2" type="image/png" sizes="32x32"><meta name="description" content="源码地址-codepenThreejs框架，使用JS控制背景变换，镜头移动，控制模型变换等。">
<meta property="og:type" content="article">
<meta property="og:title" content="Threejs-Jumping sheep">
<meta property="og:url" content="http://example.com/2022/03/24/Threejs-Jumping%20sheep/index.html">
<meta property="og:site_name" content="LJY_BLOG">
<meta property="og:description" content="源码地址-codepenThreejs框架，使用JS控制背景变换，镜头移动，控制模型变换等。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2022/03/d91385318e845d0b.gif">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2022/03/1826fb58f0f4cad5.jpg">
<meta property="article:published_time" content="2022-03-24T01:42:37.000Z">
<meta property="article:modified_time" content="2022-03-24T06:53:08.124Z">
<meta property="article:author" content="LJY">
<meta property="article:tag" content="学习笔记">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s3.bmp.ovh/imgs/2022/03/d91385318e845d0b.gif"><title>Threejs-Jumping sheep | LJY_BLOG</title><link ref="canonical" href="http://example.com/2022/03/24/Threejs-Jumping%20sheep/"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.6.2"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  assistSearch: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: {"enable":true,"showOnPost":true,"scrollDownIcon":false},
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"default","highlight":"light","wordWrap":false},
  reward: false,
  fancybox: false,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: undefined,
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"Copy","copySuccess":"Copy Success","copyError":"Copy Error"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 5.4.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">主页</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">档案</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/tags/"><span class="header-nav-menu-item__icon"><i class="fas fa-tags"></i></span><span class="header-nav-menu-item__text">标签</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/reading/"><span class="header-nav-menu-item__icon"><i class="fas fa-book"></i></span><span class="header-nav-menu-item__text">阅读</span></a></div></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">LJY_BLOG</div><div class="header-banner-info__subtitle"></div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content" id="content"><!-- Just used to judge whether it is an article page--><div id="is-post"></div><div class="post"><header class="post-header"><h1 class="post-title">Threejs-Jumping sheep</h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">创建</span><span class="post-meta-item__value">2022-03-24</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新</span><span class="post-meta-item__value">2022-03-24</span></span><span class="post-meta-item post-meta-item--readtime"><span class="post-meta-item__icon"><i class="far fa-clock"></i></span><span class="post-meta-item__info">阅读时间</span><span class="post-meta-item__value">37m</span></span></div></header><div class="post-body"><p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://codepen.io/kffein/pen/JjNPqRq?editors=1010">源码地址-codepen</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span><br>Threejs框架，使用JS控制背景变换，镜头移动，控制模型变换等。</p>
<p><img src="https://s3.bmp.ovh/imgs/2022/03/d91385318e845d0b.gif" alt="01"></p>
<span id="more"></span>


        <h1 id="预备知识">
          <a href="#预备知识" class="heading-link"><i class="fas fa-link"></i></a><a href="#预备知识" class="headerlink" title="预备知识"></a>预备知识</h1>
      <p>// 获取gltf 对象实例！ - 可修改<br>corps = sheepGroup.getObjectByName(‘corps’);<br>head = sheepGroup.getObjectByName(‘Head’);</p>

        <h1 id="功能实现">
          <a href="#功能实现" class="heading-link"><i class="fas fa-link"></i></a><a href="#功能实现" class="headerlink" title="功能实现"></a>功能实现</h1>
      <ol>
<li>鼠标移动，头部跟着移动</li>
<li>眨眼动画效果实现</li>
<li>点击跳跃-实现鼠标、手机、按键的实现</li>
<li>跳跃之前的动画实现 - 下蹲，脸部变色</li>
<li>跳跃中的动画实现 - 跃起角度变换</li>
<li>跳跃不同高度，显示不同的背景 - 背景变换</li>
<li>超出跳跃的高度，触发拉便便效果，同时改变镜头。。。- 计数实现</li>
</ol>

        <h1 id="代码细节">
          <a href="#代码细节" class="heading-link"><i class="fas fa-link"></i></a><a href="#代码细节" class="headerlink" title="代码细节"></a>代码细节</h1>
      
        <h2 id="加载资源">
          <a href="#加载资源" class="heading-link"><i class="fas fa-link"></i></a><a href="#加载资源" class="headerlink" title="加载资源"></a>加载资源</h2>
      <ol>
<li>three.js - 核心库</li>
<li>GLTFLoader.js - 加载模型</li>
<li>BufferGeometryUtils - 模型合并操作</li>
<li>gsap - 背景变换<figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">https://unpkg.com/three@0.128.0/build/three.js</span><br><span class="line">https://unpkg.com/three@0.128.0/examples/js/loaders/GLTFLoader.js</span><br><span class="line">https://unpkg.com/three@0.128.0/examples/js/utils/BufferGeometryUtils.js</span><br><span class="line">https://unpkg.co/gsap@3/dist/gsap.min.js</span><br></pre></td></tr></tbody></table></div></figure></li>
</ol>

        <h2 id="定义变量">
          <a href="#定义变量" class="heading-link"><i class="fas fa-link"></i></a><a href="#定义变量" class="headerlink" title="定义变量"></a>定义变量</h2>
      <figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">//THREEJS Variables</span><br><span class="line">let renderer,</span><br><span class="line">	camera,</span><br><span class="line">	scene,// 基础场景搭建scene,camera,renderer</span><br><span class="line">	floor,</span><br><span class="line">	cameraTarget = new THREE.Vector3(), // 控制镜头！！！</span><br><span class="line">	shadowLight, // light</span><br><span class="line">	keyLight,</span><br><span class="line">	hemiLight,</span><br><span class="line">	sheepGroup, // 各个模型的组合 - 统一渲染 - 方便控制（foreach）</span><br><span class="line">	spaceGroup,</span><br><span class="line">	cloudsGroup,</span><br><span class="line">	treeGroup,</span><br><span class="line">	head,// 模型内部细节</span><br><span class="line">	poo,</span><br><span class="line">	corps,</span><br><span class="line">	eyeLeft,</span><br><span class="line">	eyeRight,</span><br><span class="line">	pupilleLeft,</span><br><span class="line">	pupilleRight;</span><br><span class="line"></span><br><span class="line">let isDown = false, // 标记变量</span><br><span class="line">	downCounter = 0, // 计数 - 放入循环中</span><br><span class="line">	pooCounter = 0, </span><br><span class="line">	status = 'default', // 通过状态控制 - 字符串！</span><br><span class="line">	mouse = {</span><br><span class="line">		x: 0,</span><br><span class="line">		y: 0</span><br><span class="line">	},</span><br><span class="line">	currentJumpStemp = 0; // 跳多高？？？？</span><br><span class="line"></span><br><span class="line">// Whole config</span><br><span class="line">const CONFIG = {</span><br><span class="line">	CAMERA: { // CAMERA参数调节</span><br><span class="line">		fov: 45,</span><br><span class="line">		nearPlane: 1,</span><br><span class="line">		farPlane: 20,</span><br><span class="line">	},</span><br><span class="line">	PHYSICS: { // 物体数据调节 - 用于比较 - 累加</span><br><span class="line">		gravity: 0.1,</span><br><span class="line">		falling: false,</span><br><span class="line">		colorize: false,</span><br><span class="line">		force: 0,</span><br><span class="line">		forceTarget: 0,</span><br><span class="line">	},</span><br><span class="line">	BLINK: { // 展演动画 - 主要是时间参数。</span><br><span class="line">		delay: THREE.MathUtils.randInt(100, 300),</span><br><span class="line">		counter: 0,</span><br><span class="line">	length: 7,</span><br><span class="line">		double: false,</span><br><span class="line">	},</span><br><span class="line">	STEPS: [{ // 跳跃高度 - 角度控制，颜色变化（给背景的？？ - yes - gasp控制）</span><br><span class="line">		altitude: 2,</span><br><span class="line">		impulse: 0.2,</span><br><span class="line">		angle: 10,</span><br><span class="line">		diffStart: 0,</span><br><span class="line">		flyingLerp: 0.05,</span><br><span class="line">		colorStart: '#cfe1e3',</span><br><span class="line">		colorEnd: '#cfe1e3',</span><br><span class="line">	},</span><br><span class="line">	{</span><br><span class="line">		altitude: 6,</span><br><span class="line">		impulse: 0.15,</span><br><span class="line">		angle: 22,</span><br><span class="line">		diffStart: 0,</span><br><span class="line">		flyingLerp: 0.05,</span><br><span class="line">		colorStart: '#51c7ab',</span><br><span class="line">		colorEnd: '#51b1c7',</span><br><span class="line">	},</span><br><span class="line">	{</span><br><span class="line">		altitude: 12,</span><br><span class="line">		impulse: 0.1,</span><br><span class="line">		angle: 30,</span><br><span class="line">		diffStart: 1.5,</span><br><span class="line">		flyingLerp: 0.03,</span><br><span class="line">		colorStart: '#6eaceb',</span><br><span class="line">		colorEnd: '#4f9be8',</span><br><span class="line">	},</span><br><span class="line">	{</span><br><span class="line">		altitude: 30,</span><br><span class="line">		impulse: 0.05,</span><br><span class="line">		angle: 40,</span><br><span class="line">		diffStart: 3,</span><br><span class="line">		flyingLerp: 0.015,</span><br><span class="line">		colorStart: '#0f0d1c',</span><br><span class="line">		colorEnd: '#000000',</span><br><span class="line">	}],</span><br><span class="line">	COLORS: { // 整体颜色变量 - 云，地面，树，树叶，便便，变脸</span><br><span class="line">		clouds: 0xfefae0,</span><br><span class="line">		floor: 0x4b6b30,</span><br><span class="line">		tree: 0x1a1412,</span><br><span class="line">		leaf: 0x133019,</span><br><span class="line">		poo: 0x402e2a,</span><br><span class="line">		white: new THREE.Color(1, 1, 1),</span><br><span class="line">		red: new THREE.Color(0xf71735),</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></div></figure>


        <h2 id="init函数">
          <a href="#init函数" class="heading-link"><i class="fas fa-link"></i></a><a href="#init函数" class="headerlink" title="init函数"></a>init函数</h2>
      <p>init()</p>
<figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">设置scene, camera, renderer</span><br><span class="line"></span><br><span class="line">设置全局事件 </span><br><span class="line">窗口变换</span><br><span class="line">鼠标按下 - 触摸开始 - onDown</span><br><span class="line">鼠标抬起 - 触摸结束 - onUp</span><br><span class="line">鼠标移动 - 触摸移动 - onMove - onTouchMove</span><br><span class="line">键盘按下 - onKeyDown</span><br><span class="line">键盘抬起 - onKeyUp</span><br><span class="line"></span><br><span class="line">window.addEventListener("resize", onResize);</span><br><span class="line">window.addEventListener("mousedown", onDown);</span><br><span class="line">window.addEventListener("touchstart", onDown);</span><br><span class="line">window.addEventListener("mouseup", onUp);</span><br><span class="line">window.addEventListener("touchend", onUp);</span><br><span class="line">window.addEventListener("mousemove", onMove);</span><br><span class="line">window.addEventListener("touchmove", onTouchMove);</span><br><span class="line">window.addEventListener("keydown", onKeyDown);</span><br><span class="line">window.addEventListener("keyup", onKeyUp);</span><br><span class="line"></span><br></pre></td></tr></tbody></table></div></figure>


        <h2 id="添加模型">
          <a href="#添加模型" class="heading-link"><i class="fas fa-link"></i></a><a href="#添加模型" class="headerlink" title="添加模型"></a>添加模型</h2>
      
        <h3 id="addFloor">
          <a href="#addFloor" class="heading-link"><i class="fas fa-link"></i></a><a href="#addFloor" class="headerlink" title="addFloor()"></a>addFloor()</h3>
      <p>添加一个Mesh，修改x轴，修改z位置，定义接收阴影，设置水平放大效果<br>添加进场景</p>
<figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">floor = new THREE.Mesh(new THREE.PlaneGeometry(1, 1, 1), new THREE.MeshLambertMaterial({</span><br><span class="line">	color: CONFIG.COLORS.floor</span><br><span class="line">}));</span><br><span class="line">floor.rotation.x = -Math.PI / 2;</span><br><span class="line">floor.position.z = 1;</span><br><span class="line">floor.receiveShadow = true;</span><br><span class="line">floor.scale.set(20, 10, 1);</span><br><span class="line">scene.add(floor);</span><br></pre></td></tr></tbody></table></div></figure>


        <h3 id="addSheep">
          <a href="#addSheep" class="heading-link"><i class="fas fa-link"></i></a><a href="#addSheep" class="headerlink" title="addSheep()"></a>addSheep()</h3>
      <p>Blender中查看模型细节 - 可用Js绑定该位置 - 然后调整参数！<br><img src="https://s3.bmp.ovh/imgs/2022/03/1826fb58f0f4cad5.jpg" alt="02"></p>
<p>通过GLTFLoader加载模型 - 异步<br>设置位置，缩放，接收阴影，投掷阴影效果，旋转Y轴 - 添加进sheepGroup - 添加进场景</p>
<p>定义便便模型 - 一个正方形 - 褐色。<br>定义名字，位置（隐藏在地板下），<strong>写入userData数据</strong>（<strong>保存模型数据</strong>） - 添加进sheepGroup</p>
<p>定义数据集 - 来自 小羊模型 ，遍历模型，<strong>写入userData数据</strong>，接收阴影</p>
<p>把 小羊模型 每个部分，绑定全局变量 - 用于修改参数！</p>
<figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">const loader = new THREE.GLTFLoader();</span><br><span class="line">loader.load(</span><br><span class="line">	'https://brand.kffein.com/codepen/jumping-sheep/sheep.gltf',</span><br><span class="line">	(gltf) =&gt; {</span><br><span class="line">		sheepGroup = gltf.scene;</span><br><span class="line">		sheepGroup.position.set(0, 0, 0.8);</span><br><span class="line">		sheepGroup.scale.set(0.5, 0.5, 0.5)</span><br><span class="line">		sheepGroup.receiveShadow = true;</span><br><span class="line">		sheepGroup.castShadow = true;</span><br><span class="line">		sheepGroup.rotation.y = THREE.MathUtils.degToRad(-50);</span><br><span class="line">		// 添加！</span><br><span class="line">		scene.add(sheepGroup);</span><br><span class="line">		// 粑粑</span><br><span class="line">		poo = new THREE.Mesh(new THREE.BoxGeometry(0.25, 0.25, 0.25), new THREE.MeshLambertMaterial({</span><br><span class="line">			fog: false,</span><br><span class="line">			color: CONFIG.COLORS.poo</span><br><span class="line">		}));</span><br><span class="line">		poo.name = "poo";</span><br><span class="line">		poo.position.set(0, -1.2, 0)</span><br><span class="line">		poo.userData.position = poo.position.clone();</span><br><span class="line">		sheepGroup.add(poo);</span><br><span class="line">		</span><br><span class="line">		const exceptions = ['corps', 'Head', 'Nose', 'Face', 'EyeLeft', 'EyeRight'];</span><br><span class="line">		sheepGroup.traverse(child =&gt; {</span><br><span class="line">			if (child.isMesh) {</span><br><span class="line">				child.material.fog = false;</span><br><span class="line">				// userData - 写入做什么？</span><br><span class="line">				child.userData.position = child.position.clone();</span><br><span class="line">				child.userData.scale = child.scale.clone();</span><br><span class="line">				child.castShadow = true;</span><br><span class="line">				if (exceptions.indexOf(child.name) === -1) child.receiveShadow = true;</span><br><span class="line">			}</span><br><span class="line">		});</span><br><span class="line">		// 获取gltf 对象实例！ - 可修改</span><br><span class="line">		corps = sheepGroup.getObjectByName('corps');</span><br><span class="line">		head = sheepGroup.getObjectByName('Head');</span><br><span class="line">		</span><br><span class="line">		eyeLeft = head.getObjectByName("EyeLeft");</span><br><span class="line">		eyeRight = head.getObjectByName("EyeRight");</span><br><span class="line">		pupilleLeft = head.getObjectByName("PupilleLeft");</span><br><span class="line">		pupilleRight = head.getObjectByName("PupilleRight");</span><br><span class="line">		</span><br><span class="line">		pateBottomLeft = sheepGroup.getObjectByName("pateBottomLeft");</span><br><span class="line">		pateBottomRight = sheepGroup.getObjectByName("pateBottomRight");</span><br><span class="line">		pateFrontLeft = sheepGroup.getObjectByName("pateFrontLeft");</span><br><span class="line">		pateFrontRight = sheepGroup.getObjectByName("pateFrontRight");</span><br><span class="line">	},</span><br><span class="line">);</span><br></pre></td></tr></tbody></table></div></figure>


        <h3 id="addDecor">
          <a href="#addDecor" class="heading-link"><i class="fas fa-link"></i></a><a href="#addDecor" class="headerlink" title="addDecor()"></a>addDecor()</h3>
      <p>添加树模型 - CylinderGeometry + SphereGeometry + clone()<br>添加云模型 - BoxGeometry * 3 + mergeBufferGeometries<br>添加星星 - BufferGeometry * 1000</p>
<figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">//------ TREES</span><br><span class="line">// 统一渲染，节约性能</span><br><span class="line">treeGroup = new THREE.Group();</span><br><span class="line">treeGroup.position.set(3, 1, 0);</span><br><span class="line">scene.add(treeGroup);</span><br><span class="line"></span><br><span class="line">const treeGeom = new THREE.CylinderGeometry(.2, .2, 6, 3);</span><br><span class="line">const tree = new THREE.Mesh(treeGeom, new THREE.MeshToonMaterial({</span><br><span class="line">	fog: false,</span><br><span class="line">	color: CONFIG.COLORS.tree</span><br><span class="line">}));</span><br><span class="line">tree.castShadow = true;</span><br><span class="line">tree.position.x = -0.15;</span><br><span class="line">tree.position.z = 1.2;</span><br><span class="line">tree.rotation.y = Math.PI / 2;</span><br><span class="line">treeGroup.add(tree);</span><br><span class="line"></span><br><span class="line">const leafGeom = new THREE.SphereGeometry(2, 4, 4);</span><br><span class="line">const leaf = new THREE.Mesh(leafGeom, new THREE.MeshToonMaterial({</span><br><span class="line">	fog: false,</span><br><span class="line">	color: CONFIG.COLORS.leaf</span><br><span class="line">}));</span><br><span class="line">leaf.position.set(0, 3, 0);</span><br><span class="line">leaf.scale.set(0.75, 0.75, 0.75);</span><br><span class="line">tree.add(leaf);</span><br><span class="line"></span><br><span class="line">// 另一棵树</span><br><span class="line">const treeLeft = tree.clone();</span><br><span class="line">treeLeft.rotation.y = -Math.PI / 2;</span><br><span class="line">treeLeft.position.set(-6, -1.25, -0.5)</span><br><span class="line">treeGroup.add(treeLeft);</span><br><span class="line"></span><br><span class="line">//---- CLOUDS</span><br><span class="line">cloudsGroup = new THREE.Group();</span><br><span class="line">cloudsGroup.position.set(0, 8, 0);</span><br><span class="line">scene.add(cloudsGroup);</span><br><span class="line"></span><br><span class="line">const cloudPart1 = new THREE.BoxGeometry(1.5, 1.5, 1.5)</span><br><span class="line">const cloudPart2 = new THREE.BoxGeometry(1.5, 1.5, 1.5)</span><br><span class="line">const cloudPart3 = new THREE.BoxGeometry(1.5, 1.5, 1.5)</span><br><span class="line">cloudPart1.translate(-0.5, 0, 0);</span><br><span class="line">cloudPart2.translate(0, 0.5, 0);</span><br><span class="line">cloudPart3.translate(1, -0.5, 0);</span><br><span class="line"></span><br><span class="line">// 合并Geometry</span><br><span class="line">const cloudGeom = THREE.BufferGeometryUtils.mergeBufferGeometries([cloudPart1, cloudPart2, cloudPart3]);</span><br><span class="line">const cloud = new THREE.Mesh(cloudGeom, new THREE.MeshLambertMaterial({</span><br><span class="line">	fog: false,</span><br><span class="line">	color: CONFIG.COLORS.clouds</span><br><span class="line">}, 500));</span><br><span class="line">cloud.scale.set(1, 0.7, 0.8);</span><br><span class="line">cloud.rotation.y = -Math.PI / 8;</span><br><span class="line">cloud.position.set(6, 4, -10);</span><br><span class="line">cloudsGroup.add(cloud);</span><br><span class="line"></span><br><span class="line">const cloudLeft = cloud.clone();</span><br><span class="line">cloudLeft.scale.set(1.2, 0.8, 0.5);</span><br><span class="line">cloudLeft.position.set(-8, 1, -7);</span><br><span class="line">cloudLeft.rotation.y = -Math.PI / 12;</span><br><span class="line">cloudsGroup.add(cloudLeft);</span><br><span class="line"></span><br><span class="line">//---- SPACE</span><br><span class="line">spaceGroup = new THREE.Group();</span><br><span class="line">spaceGroup.position.set(0, 30, 0);</span><br><span class="line"></span><br><span class="line">const vertices = [];</span><br><span class="line">for (let i = 0; i &lt; 1000; i++) {</span><br><span class="line"></span><br><span class="line">	// 随机函数！！！</span><br><span class="line">	const x = THREE.MathUtils.randFloatSpread(10);</span><br><span class="line">	const y = THREE.MathUtils.randFloatSpread(10);</span><br><span class="line">	const z = THREE.MathUtils.randFloatSpread(10);</span><br><span class="line">	vertices.push(x, y, z);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">const spaceGeom = new THREE.BufferGeometry();</span><br><span class="line">spaceGeom.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));</span><br><span class="line">const spaceMat = new THREE.PointsMaterial({</span><br><span class="line">	size: 0.02,</span><br><span class="line">	fog: false,</span><br><span class="line">	transparent: true,</span><br><span class="line">	color: 0xFFFFFF</span><br><span class="line">});</span><br><span class="line">const points = new THREE.Points(spaceGeom, spaceMat);</span><br><span class="line"></span><br><span class="line">spaceGroup.add(points)</span><br><span class="line">scene.add(spaceGroup);</span><br><span class="line"></span><br></pre></td></tr></tbody></table></div></figure>




        <h3 id="addLights">
          <a href="#addLights" class="heading-link"><i class="fas fa-link"></i></a><a href="#addLights" class="headerlink" title="addLights()"></a>addLights()</h3>
      <p>添加DirectionalLight * 2 + HemisphereLight</p>
<figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">shadowLight = new THREE.DirectionalLight(0xffffff, 1);</span><br><span class="line">shadowLight.position.set(0.5, 5, 2.5);</span><br><span class="line">shadowLight.castShadow = true;</span><br><span class="line">scene.add(shadowLight);</span><br><span class="line"></span><br><span class="line">keyLight = new THREE.DirectionalLight(0xffffff, 1);</span><br><span class="line">keyLight.position.set(3, 0, 1);</span><br><span class="line">scene.add(keyLight);</span><br><span class="line"></span><br><span class="line">hemiLight = new THREE.HemisphereLight(0xffffff, 0xffffff, 0.5);</span><br><span class="line">scene.add(hemiLight);</span><br></pre></td></tr></tbody></table></div></figure>


        <h2 id="run">
          <a href="#run" class="heading-link"><i class="fas fa-link"></i></a><a href="#run" class="headerlink" title="run()"></a>run()</h2>
      <p>每次循环要做的事情！ - 重点优化所在</p>
<p>if (!sheepGroup) return; - 如果没有加载出来，不执行。</p>
<p>if (isDown) - 按下 - 计数</p>
<p>if (!CONFIG.PHYSICS.force &amp;&amp; status === ‘default’) -移动头部动画 + 跳跃之前动画<br>else if (status === ‘poo’) - 拉便便动画</p>
<p>updateFlying(); // falling + flying</p>
<p>//update elements position - camera, sheepGroup, shadowLight, keyLight</p>
<p>//camera lookAt - cameraTarget(sheepGroup.position)</p>
<p>//render - </p>
<figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">render();</span><br><span class="line">requestAnimationFrame(run);</span><br><span class="line"></span><br><span class="line">function render() {</span><br><span class="line">	if (!sheepGroup) return;</span><br><span class="line">	//increment the down counter</span><br><span class="line">	</span><br><span class="line">	if (isDown) {</span><br><span class="line">		downCounter += 1;</span><br><span class="line">		// console.log(downCounter)</span><br><span class="line">	}</span><br><span class="line">	</span><br><span class="line">	if (!CONFIG.PHYSICS.force &amp;&amp; status === 'default') {</span><br><span class="line">		// move head sheep</span><br><span class="line">		updateHead();</span><br><span class="line">		// do anim before jumping</span><br><span class="line">		updateFlexion();</span><br><span class="line">	} else if (status === 'poo') {</span><br><span class="line">		// 如何进入这里 - status</span><br><span class="line">		makeAPoo();</span><br><span class="line">	}</span><br><span class="line">	</span><br><span class="line">	updateFlying();</span><br><span class="line">	</span><br><span class="line">	//update elements position</span><br><span class="line">	camera.position.y = 1 + CONFIG.PHYSICS.force + (CONFIG.PHYSICS.force * 0.1);</span><br><span class="line">	sheepGroup.position.y = 0.65 + CONFIG.PHYSICS.force;</span><br><span class="line">	shadowLight.position.y = 5 + CONFIG.PHYSICS.force;</span><br><span class="line">	keyLight.position.y = CONFIG.PHYSICS.force;</span><br><span class="line">	</span><br><span class="line">	// camera lookAt</span><br><span class="line">	cameraTarget.set(sheepGroup.position.x, sheepGroup.position.y, sheepGroup.position.z);</span><br><span class="line">	camera.lookAt(cameraTarget);</span><br><span class="line">	</span><br><span class="line">	//render</span><br><span class="line">	renderer.render(scene, camera);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></div></figure>


        <h2 id="功能函数">
          <a href="#功能函数" class="heading-link"><i class="fas fa-link"></i></a><a href="#功能函数" class="headerlink" title="功能函数"></a>功能函数</h2>
      
        <h3 id="jump">
          <a href="#jump" class="heading-link"><i class="fas fa-link"></i></a><a href="#jump" class="headerlink" title="jump()"></a>jump()</h3>
      <p>currentJumStep - 取 按下计数 / 25， CONFIG.STEPS.length - 1 的最小值，</p>
<p>sheepGroup.rotation.z - THREE.MathUtils.degToRad(CONFIG.STEPS[currentJumpStemp].angle) - <strong>角度</strong></p>
<p>CONFIG.PHYSICS.forceTarget - 取CONFIG.STEPS[currentJumpStemp].altitude - <strong>高度</strong></p>
<p>downCounter - 0<br>pooCounter - 0<br>status - “jump” - <strong>状态</strong></p>
<p>updateHead() - 重置位置 - 里面有<strong>跳跃和非跳跃</strong>两种变换条件</p>
<p>// 什么时候调用jump() ???? onUp() - 抬起事件！！！</p>
<figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// 140/25 - 5.6 和 3 比较, 这里不是超时停止的位置。</span><br><span class="line">currentJumpStemp = Math.min(Math.round(downCounter / 25), CONFIG.STEPS.length - 1);</span><br><span class="line">// console.log(currentJumpStemp, Math.round(downCounter / 25), CONFIG.STEPS.length - 1)</span><br><span class="line"></span><br><span class="line">sheepGroup.rotation.z = THREE.MathUtils.degToRad(CONFIG.STEPS[currentJumpStemp].angle);</span><br><span class="line">CONFIG.PHYSICS.forceTarget = CONFIG.STEPS[currentJumpStemp].altitude;</span><br><span class="line">downCounter = 0;</span><br><span class="line">pooCounter = 0;</span><br><span class="line">status = 'jump';</span><br><span class="line"></span><br><span class="line">//reset the position because we are already jumping</span><br><span class="line">updateHead();</span><br></pre></td></tr></tbody></table></div></figure>


        <h3 id="updateHead">
          <a href="#updateHead" class="heading-link"><i class="fas fa-link"></i></a><a href="#updateHead" class="headerlink" title="updateHead()"></a>updateHead()</h3>
      <p>if (eyeLeft.userData.beforeJump &amp;&amp; eyeRight.userData.beforeJump) - 设置为false - 开关？</p>
<ul>
<li>resetEyes() - 设置为false</li>
<li>updateHead() - else 中设置为true</li>
</ul>
<p>if (downCounter === 0) - <strong>没有起跳的时候</strong></p>
<ul>
<li>if (CONFIG.BLINK.counter &gt; CONFIG.BLINK.delay &amp;&amp; CONFIG.BLINK.counter &lt;= CONFIG.BLINK.delay + CONFIG.BLINK.length)<br>  // 没超过就可以执行眨眼动画！</li>
<li>else if (CONFIG.BLINK.counter &gt; CONFIG.BLINK.delay + CONFIG.BLINK.length)<br>  // 超了就重置！重置左右眼睛的y轴 + counter + delay(随机来一个数值！)</li>
</ul>
<p>else - <strong>起跳了！</strong></p>
<ul>
<li>head角度变换 - lerp</li>
<li>concentration - 变形幅度 - Math.min(1, downCounter / 100);</li>
<li>eyeLeft + eyeRight 变形（眼球） - scale</li>
<li>pupilleLeft + pupilleRight 变形（眼珠）- scale</li>
<li>CONFIG.BLINK.counter = 0;</li>
<li>colorLerp - 变色幅度 -  Math.min(1, downCounter / 50);</li>
<li>pooBurnOut - colorLerp === 1; - 拉便便之前的状态控制。。。</li>
<li>head.material.color.lerpColors - 变色秘法</li>
<li>if (pooBurnOut) - 修改头部位置 + pooCounter 累加！<ul>
<li>if (pooCounter &gt;= 90) - 修改状态</li>
</ul>
</li>
</ul>
<p>// 什么时候调用updateHead() ??? </p>
<ul>
<li>jump()中（用于停止movehaed） </li>
<li>render中 if判断（用于movehead）</li>
</ul>
<figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">// true or false</span><br><span class="line">if (eyeLeft.userData.beforeJump &amp;&amp; eyeRight.userData.beforeJump) {</span><br><span class="line">	resetEyes();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">//--- follow mouse</span><br><span class="line">// 这里的数据不好理解。。。趋近</span><br><span class="line">// 这缩进看的明白 - 没有计数时！</span><br><span class="line">if (downCounter === 0) {</span><br><span class="line">	head.rotation.y = THREE.MathUtils.lerp(head.rotation.y, mouse.x - THREE.MathUtils.degToRad(55), 0.15);</span><br><span class="line">	head.rotation.z = THREE.MathUtils.lerp(head.rotation.z, mouse.y - THREE.MathUtils.degToRad(5), 0.1);</span><br><span class="line">	head.material.color.lerpColors(CONFIG.COLORS.white, CONFIG.COLORS.red, 0);</span><br><span class="line"></span><br><span class="line">	//----- blink</span><br><span class="line">	if (CONFIG.BLINK.counter &gt; CONFIG.BLINK.delay &amp;&amp; CONFIG.BLINK.counter &lt;= CONFIG.BLINK.delay + CONFIG.BLINK</span><br><span class="line">		.length) {</span><br><span class="line">		// 时间 + y变化！</span><br><span class="line">		eyeLeft.scale.y = Math.min(0, eyeLeft.scale.y + 0.06);</span><br><span class="line">		eyeRight.scale.y = Math.min(0, eyeRight.scale.y + 0.06);</span><br><span class="line">	} else if (CONFIG.BLINK.counter &gt; CONFIG.BLINK.delay + CONFIG.BLINK.length) {</span><br><span class="line">		eyeLeft.scale.y = eyeLeft.userData.scale.y;</span><br><span class="line">		eyeRight.scale.y = eyeRight.userData.scale.y;</span><br><span class="line">		CONFIG.BLINK.counter = 0;</span><br><span class="line">		CONFIG.BLINK.delay = THREE.MathUtils.randInt(100, 300);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	CONFIG.BLINK.counter += 1;</span><br><span class="line">	</span><br><span class="line">} else {</span><br><span class="line">	// 跳跃计数中！</span><br><span class="line">	head.rotation.y = THREE.MathUtils.lerp(head.rotation.y, 0.74 - THREE.MathUtils.degToRad(55), 0.25);</span><br><span class="line">	head.rotation.z = THREE.MathUtils.lerp(head.rotation.z, 0.55 - THREE.MathUtils.degToRad(5), 0.2);</span><br><span class="line">	</span><br><span class="line">	const concentration = Math.min(1, downCounter / 100);</span><br><span class="line">	eyeLeft.userData.beforeJump = true;</span><br><span class="line">	eyeRight.userData.beforeJump = true;</span><br><span class="line">	eyeLeft.scale.y = Math.min(-0.15, eyeLeft.userData.scale.y + (concentration * 0.8));</span><br><span class="line">	eyeRight.scale.y = Math.min(-0.15, eyeRight.userData.scale.y + (concentration * 0.8));</span><br><span class="line">	</span><br><span class="line">	pupilleLeft.scale.y = Math.min(0.3, pupilleLeft.userData.scale.y + (concentration * 0.8));</span><br><span class="line">	pupilleRight.scale.y = Math.min(0.3, pupilleLeft.userData.scale.y + (concentration * 0.8));</span><br><span class="line">	</span><br><span class="line">	CONFIG.BLINK.counter = 0;</span><br><span class="line">	const colorLerp = Math.min(1, downCounter / 50);// 取最小值，按下超过50？？？嗯！</span><br><span class="line">	const pooBurnOut = colorLerp === 1;</span><br><span class="line">	head.material.color.lerpColors(CONFIG.COLORS.white, CONFIG.COLORS.red, colorLerp);</span><br><span class="line">	</span><br><span class="line">	//shaking - warning</span><br><span class="line">	if (pooBurnOut) {</span><br><span class="line">	// 头部变化</span><br><span class="line">		head.position.x = head.userData.position.x + (Math.cos(downCounter) * 0.01);</span><br><span class="line">		head.position.y = head.userData.position.y - (Math.sin(downCounter) * 0.01);</span><br><span class="line">		// console.log('pooBurnOut=',pooBurnOut, 'pooCounter=',pooCounter, 'downCounter=',downCounter)</span><br><span class="line">	</span><br><span class="line">	// 累加？</span><br><span class="line">		pooCounter += 1;</span><br><span class="line">	</span><br><span class="line">		if (pooCounter &gt;= 90) {</span><br><span class="line">			status = 'poo';</span><br><span class="line">			// 这里控制了超过的状态</span><br><span class="line">			// 140 = 50 + 90！！！完全了解！！太赞了，状态控制，若有所思。。。</span><br><span class="line">			// console.log('pooBurnOut=',pooBurnOut, 'pooCounter=',pooCounter, 'downCounter=',downCounter)</span><br><span class="line">			console.log(pooCounter) // 只有90</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></div></figure>



        <h3 id="updateFlexion">
          <a href="#updateFlexion" class="heading-link"><i class="fas fa-link"></i></a><a href="#updateFlexion" class="headerlink" title="updateFlexion()"></a>updateFlexion()</h3>
      <p>把绑定好的数据，一起放入数组，统一处理，，！！！<br>if (downCounter &gt; 0) - 按下 - 整体下降<br>else - 抬起 - 还原位置</p>
<p>什么时候用updateFlexion()？？？</p>
<ul>
<li>makeAPoo() - if (pooCounter &lt;= 200) 中</li>
<li>updateFlying() - else if (CONFIG.PHYSICS.forceTarget) 中</li>
<li>render() - if (!CONFIG.PHYSICS.force &amp;&amp; status === ‘default’) 中</li>
</ul>
<p>这里未解。。。。。。。。。。</p>
<figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">// 把绑定好的数据，一起放入数组，统一处理，，！！！</span><br><span class="line">const feets = [pateBottomLeft, pateBottomRight, pateFrontLeft, pateFrontRight]</span><br><span class="line"></span><br><span class="line">if (downCounter &gt; 0) {</span><br><span class="line">	// 按下状态，</span><br><span class="line">	feets.forEach((child) =&gt; {</span><br><span class="line">		// 下降！</span><br><span class="line">		child.position.y = Math.max(-0.95, child.position.y - 0.05);</span><br><span class="line">	});</span><br><span class="line">	// 这是啥？ - 身体？？ - yes</span><br><span class="line">	corps.position.y = Math.max(-0.15, corps.position.y - 0.035);</span><br><span class="line"></span><br><span class="line">} else {</span><br><span class="line">	feets.forEach((child) =&gt; {</span><br><span class="line">		child.position.y = Math.min(child.userData.position.y, child.position.y + 0.05);</span><br><span class="line">	});</span><br><span class="line">	corps.position.y = Math.min(0, corps.position.y + 0.035);</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></div></figure>


        <h3 id="makeAPoo">
          <a href="#makeAPoo" class="heading-link"><i class="fas fa-link"></i></a><a href="#makeAPoo" class="headerlink" title="makeAPoo()"></a>makeAPoo()</h3>
      <p>if (pooCounter &lt;= 200) </p>
<ul>
<li>重置按下计数</li>
<li>重置眼睛动画</li>
<li>更新下蹲动画</li>
<li>改变眼珠朝向 - 盯着便便</li>
<li>重置头部角度和颜色</li>
<li>改变摄像头的位置，地板位置，便便位置 - lerp<br>else </li>
</ul>
<ul>
<li>改变摄像头的位置，地板位置，便便位置 - lerp - 复原</li>
<li>if (pooCounter &gt; 300) - 重置！status = ‘default’</li>
</ul>
<p>pooCounter += 1 - 累加</p>
<p>什么时候用？- render() -  else if (status === ‘poo’) {</p>
<p>这里重点，重置动画，更新位置！</p>
<figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">if (pooCounter &lt;= 200) {</span><br><span class="line">	downCounter = 0;</span><br><span class="line">	resetEyes();</span><br><span class="line">	updateFlexion();</span><br><span class="line">	</span><br><span class="line">	// look at the poo</span><br><span class="line">	pupilleLeft.position.z = pupilleLeft.userData.position.z - 0.5;</span><br><span class="line">	pupilleRight.position.z = pupilleRight.userData.position.z - 0.5;</span><br><span class="line">	</span><br><span class="line">	//reset head and color</span><br><span class="line">	head.rotation.y = THREE.MathUtils.lerp(head.rotation.y, 0.15 - THREE.MathUtils.degToRad(55), 0.25);</span><br><span class="line">	head.rotation.z = THREE.MathUtils.lerp(head.rotation.z, 0.08 - THREE.MathUtils.degToRad(5), 0.2);</span><br><span class="line">	head.material.color.lerpColors(CONFIG.COLORS.white, CONFIG.COLORS.red, 0);</span><br><span class="line">	</span><br><span class="line">	//camera focus on the poo</span><br><span class="line">	camera.position.x = THREE.MathUtils.lerp(camera.position.x, -2, 0.1);</span><br><span class="line">	floor.rotation.z = THREE.MathUtils.lerp(floor.rotation.z, THREE.MathUtils.degToRad(-28), 0.1);</span><br><span class="line">	poo.posiftion.x = THREE.MathUtils.lerp(poo.position.x, -2, 0.4);</span><br><span class="line">	poo.position.y = Math.max(-1.15, poo.position.y - CONFIG.PHYSICS.gravity);</span><br><span class="line">	poo.rotation.x = THREE.MathUtils.lerp(poo.rotation.x, Math.PI / 2, 0.12);</span><br><span class="line">} else {</span><br><span class="line">	//camera focus on the poo</span><br><span class="line">	camera.position.x = THREE.MathUtils.lerp(camera.position.x, 0, 0.1);</span><br><span class="line">	floor.rotation.z = THREE.MathUtils.lerp(floor.rotation.z, 0, 0.1);</span><br><span class="line">	poo.position.y = Math.max(-2, poo.position.y - 0.01);</span><br><span class="line">	</span><br><span class="line">	// reset</span><br><span class="line">	pupilleLeft.position.z = pupilleLeft.userData.position.z;</span><br><span class="line">	pupilleRight.position.z = pupilleRight.userData.position.z;</span><br><span class="line">	</span><br><span class="line">	if (pooCounter &gt; 300) {</span><br><span class="line">		status = 'default'</span><br><span class="line">		pooCounter = 0;</span><br><span class="line">		poo.rotation.x = 0;</span><br><span class="line">		poo.position.set(poo.userData.position.x, poo.userData.position.y, poo.userData.position.z);</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line">	pooCounter += 1</span><br></pre></td></tr></tbody></table></div></figure>


        <h3 id="updateFlying">
          <a href="#updateFlying" class="heading-link"><i class="fas fa-link"></i></a><a href="#updateFlying" class="headerlink" title="updateFlying()"></a>updateFlying()</h3>
      <p>diff - Math.abs(CONFIG.PHYSICS.force - CONFIG.PHYSICS.forceTarget);</p>
<ul>
<li>force: 0,    forceTarget: 0, 初始值</li>
<li>forceTarget - jump()中修改 - 高度altitude</li>
<li>force - render()中调整camera, sheepGroup, shadowLight, keyLight</li>
<li>force - else if (CONFIG.PHYSICS.forceTarget)中修改 - 用于趋向 forceTarget！</li>
</ul>
<p>currentStep - 从0开始 - 用于改变背景！</p>
<p>updateBackgroundAt(currentStep, 1); - 改变背景！</p>
<p>if (CONFIG.PHYSICS.falling) - 判断是否是下落状态 - <strong>上升</strong>进入状态</p>
<ul>
<li>if (!CONFIG.PHYSICS.colorize) - 开关 ？ 作用？</li>
<li>if (!CONFIG.PHYSICS.force) - 如果没有force，就重置（下降） + colorize设置false</li>
</ul>
<p>else if (CONFIG.PHYSICS.forceTarget) - 如果起跳了！</p>
<ul>
<li>if (!CONFIG.STEPS[currentJumpStemp].diffStart || diff &lt; CONFIG.STEPS[currentJumpStemp].diffStart)</li>
<li>// 初始值 + 边界条件 - 改变sheepGroup.rotation.z + CONFIG.PHYSICS.force</li>
<li>if (CONFIG.PHYSICS.force)</li>
<li>// 跳跃中 CONFIG.PHYSICS.falling = diff &lt; 0.01;</li>
</ul>
<p>else - <strong>下降！</strong>- sheepGroup.rotation.z</p>
<p>什么时候调用？？ - render()中</p>
<figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">// ---Falling</span><br><span class="line">const diff = Math.abs(CONFIG.PHYSICS.force - CONFIG.PHYSICS.forceTarget);</span><br><span class="line">let currentStep = 0;</span><br><span class="line"></span><br><span class="line">CONFIG.STEPS.forEach((step, index) =&gt; {</span><br><span class="line">	if (CONFIG.PHYSICS.force &gt; step.altitude * .5) {</span><br><span class="line">		currentStep = index;</span><br><span class="line">	}</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">updateBackgroundAt(currentStep, 1);</span><br><span class="line"></span><br><span class="line">// true or false</span><br><span class="line">if (CONFIG.PHYSICS.falling) {</span><br><span class="line">	CONFIG.PHYSICS.force = Math.max(CONFIG.PHYSICS.force - CONFIG.PHYSICS.gravity, 0);</span><br><span class="line">	CONFIG.PHYSICS.gravity += 0.0075;</span><br><span class="line">	sheepGroup.rotation.z = THREE.MathUtils.lerp(sheepGroup.rotation.z, THREE.MathUtils.degToRad(-CONFIG.STEPS[</span><br><span class="line">		currentJumpStemp].angle * .8), 0.2);</span><br><span class="line"></span><br><span class="line">	if (!CONFIG.PHYSICS.colorize) {</span><br><span class="line">		CONFIG.PHYSICS.colorize = true;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	if (!CONFIG.PHYSICS.force) {</span><br><span class="line">		reset();</span><br><span class="line">		CONFIG.PHYSICS.colorize = false;</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// ---Flying</span><br><span class="line">else if (CONFIG.PHYSICS.forceTarget) {</span><br><span class="line">	if (!CONFIG.STEPS[currentJumpStemp].diffStart || diff &lt; CONFIG.STEPS[currentJumpStemp].diffStart) {</span><br><span class="line">		sheepGroup.rotation.z = THREE.MathUtils.lerp(sheepGroup.rotation.z, 0, CONFIG.STEPS[currentJumpStemp]</span><br><span class="line">			.flyingLerp);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	CONFIG.PHYSICS.force = THREE.MathUtils.lerp(CONFIG.PHYSICS.force, CONFIG.PHYSICS.forceTarget, CONFIG.STEPS[</span><br><span class="line">		currentJumpStemp].impulse);</span><br><span class="line">	if (CONFIG.PHYSICS.force) CONFIG.PHYSICS.falling = diff &lt; 0.01;</span><br><span class="line"></span><br><span class="line">	updateFlexion();</span><br><span class="line">} else {</span><br><span class="line">	sheepGroup.rotation.z = THREE.MathUtils.lerp(sheepGroup.rotation.z, 0, 0.4);</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></div></figure>



        <h3 id="updateBackgroundAt-index-speed">
          <a href="#updateBackgroundAt-index-speed" class="heading-link"><i class="fas fa-link"></i></a><a href="#updateBackgroundAt-index-speed" class="headerlink" title="updateBackgroundAt(index, speed)"></a>updateBackgroundAt(index, speed)</h3>
      <p>step - 定位到数据集<br>bg - 找到背景的div<br>gasp.to - 设置背景颜色变换 - linear-gradient</p>
<figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const step = CONFIG.STEPS[index];</span><br><span class="line">const bg = document.querySelector(".scene-background");</span><br><span class="line">gsap.to(bg, speed, {</span><br><span class="line">	backgroundImage: `linear-gradient(0deg, ${step.colorStart} 0%, ${step.colorEnd}  100%)`</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></div></figure>


        <h3 id="reset">
          <a href="#reset" class="heading-link"><i class="fas fa-link"></i></a><a href="#reset" class="headerlink" title="reset()"></a>reset()</h3>
      <p>改变数据 - forceTarget，falling，gravity<br>改变状态 - ‘default’</p>
<figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CONFIG.PHYSICS.forceTarget = 0;</span><br><span class="line">CONFIG.PHYSICS.falling = false;</span><br><span class="line">CONFIG.PHYSICS.gravity = 0.1;</span><br><span class="line">status = 'default';</span><br></pre></td></tr></tbody></table></div></figure>


        <h3 id="resetEyes">
          <a href="#resetEyes" class="heading-link"><i class="fas fa-link"></i></a><a href="#resetEyes" class="headerlink" title="resetEyes()"></a>resetEyes()</h3>
      <p>从userData中恢复数据！<br>改变眼珠，眼球的大小 - scale</p>
<figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pupilleLeft.scale.y = pupilleLeft.userData.scale.y;</span><br><span class="line">pupilleRight.scale.y = pupilleRight.userData.scale.y;</span><br><span class="line"></span><br><span class="line">eyeLeft.scale.y = eyeLeft.userData.scale.y;</span><br><span class="line">eyeLeft.userData.beforeJump = false;</span><br><span class="line">eyeRight.scale.y = eyeRight.userData.scale.y;</span><br><span class="line">eyeRight.userData.beforeJump = false;</span><br></pre></td></tr></tbody></table></div></figure>


        <h2 id="事件函数">
          <a href="#事件函数" class="heading-link"><i class="fas fa-link"></i></a><a href="#事件函数" class="headerlink" title="事件函数"></a>事件函数</h2>
      
        <h3 id="onResize">
          <a href="#onResize" class="heading-link"><i class="fas fa-link"></i></a><a href="#onResize" class="headerlink" title="onResize()"></a>onResize()</h3>
      <p>renderer, camera 根据窗口大小，重新渲染</p>
<figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">renderer.setSize(window.innerWidth, window.innerHeight);</span><br><span class="line">camera.aspect = window.innerWidth / window.innerHeight;</span><br><span class="line">camera.updateProjectionMatrix();</span><br></pre></td></tr></tbody></table></div></figure>



        <h3 id="onDown">
          <a href="#onDown" class="heading-link"><i class="fas fa-link"></i></a><a href="#onDown" class="headerlink" title="onDown()"></a>onDown()</h3>
      <p>设置状态 为 “jump” - 是否跳跃的依据！（跳跃前，跳跃中，poo）<br>isDown = true - 开始计数</p>
<p>在哪里判断？？？ 主要给render用，每次都能考虑到它！！！</p>
<figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if (status === 'jump') return;</span><br><span class="line">isDown = true;</span><br></pre></td></tr></tbody></table></div></figure>



        <h3 id="onKeyDonw-e">
          <a href="#onKeyDonw-e" class="heading-link"><i class="fas fa-link"></i></a><a href="#onKeyDonw-e" class="headerlink" title="onKeyDonw(e)"></a>onKeyDonw(e)</h3>
      <p>判断按下的是否是空格，是<strong>调用onDown</strong></p>
<figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if (e.keyCode === 32) {</span><br><span class="line">	this.onDown();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></div></figure>


        <h3 id="onUp">
          <a href="#onUp" class="heading-link"><i class="fas fa-link"></i></a><a href="#onUp" class="headerlink" title="onUp()"></a>onUp()</h3>
      <figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">isDown = false;</span><br><span class="line">if (status === 'default') jump();</span><br></pre></td></tr></tbody></table></div></figure>


        <h3 id="onKeyUp-e">
          <a href="#onKeyUp-e" class="heading-link"><i class="fas fa-link"></i></a><a href="#onKeyUp-e" class="headerlink" title="onKeyUp(e)"></a>onKeyUp(e)</h3>
      <figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 32	Space（空格键）</span><br><span class="line">if (e.keyCode === 32) {</span><br><span class="line"> this.onUp();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></div></figure>


        <h3 id="onMove-e">
          <a href="#onMove-e" class="heading-link"><i class="fas fa-link"></i></a><a href="#onMove-e" class="headerlink" title="onMove(e)"></a>onMove(e)</h3>
      <p>修改鼠标的位置</p>
<p>在哪里使用？？ updateHead()中，修改head的旋转角度！</p>
<figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mouse.x = (e.clientX / window.innerWidth) * 2 - 1;</span><br><span class="line">mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;</span><br></pre></td></tr></tbody></table></div></figure>


        <h3 id="onTouchMove-e">
          <a href="#onTouchMove-e" class="heading-link"><i class="fas fa-link"></i></a><a href="#onTouchMove-e" class="headerlink" title="onTouchMove(e)"></a>onTouchMove(e)</h3>
      <p>和触摸的坐标位置不一样！<br>还是调用 onMove，传入当前参数！</p>
<figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">this.onMove({</span><br><span class="line">	clientX: e.touches[0].clientX,</span><br><span class="line">	clientY: e.touches[0].clientY,</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></div></figure>


        <h1 id="总结">
          <a href="#总结" class="heading-link"><i class="fas fa-link"></i></a><a href="#总结" class="headerlink" title="总结"></a>总结</h1>
      <p>写博客应该 先本地开启看看，不然内容太乱。。。</p>
<p><strong>计数 + 状态 + 数据集 + 事件</strong><br>判断依据！</p>
<p>先定义好数据集，考虑的是<strong>全局变量</strong>的使用！<br>计数 - 从0到1，累加通过render来实现，不同数值，对应不同的状态！<br>状态 - 用于判断的依据！累加到一定程度，进入对应的状态 - 状态转换机？？？<br>事件 - 主要用于修改状态 - 起开关作用 - 在render中进行判断！</p>
<p>这里还没有仔细分析，里面的参数，多少到多少，转的角度，移动距离，时间长短，边界条件。。</p>
<p>如何保存数据 - userData，写入该属性。<br>如何获取模型中的某一部分 - 获取实例 - sheepGroup.getObjectByName(‘corps’);<br>如何控制模型变换 - 什么时候，变换那些地方，这么重置 - 还需要再看看。。<br>如何计数 - 在循环中累加 1 即可，不同范围对应不同状态<br>如何控制状态 - &amp;&amp; ！ 字符串</p>
<p>再写几个！很有收获的案例！！！</p>
</div><footer class="post-footer"><div class="post-ending ending"><div class="ending__text">------ END ------</div></div><div class="post-tags"><span class="post-tags-item"><span class="post-tags-item__icon"><i class="fas fa-tag"></i></span><a class="post-tags-item__link" href="http://example.com/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a></span></div><div class="post-share"><div class="social-share" data-sites="qzone, qq, weibo, wechat, douban, linkedin, facebook, twitter, google">Share to: </div></div><nav class="post-paginator paginator"><div class="paginator-next"><a class="paginator-next__link" href="/2022/03/14/50%E4%B8%AA%E5%AE%9E%E7%94%A8%E5%B0%8F%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><span class="paginator-prev__text">50个实用小项目学习笔记</span><span class="paginator-next__icon"><i class="fas fa-angle-right"></i></span></a></div></nav></footer></div></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><div class="sidebar-nav"><span class="sidebar-nav-toc current">Catalog</span><span class="sidebar-nav-ov">Overview</span></div><section class="sidebar-toc"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A2%84%E5%A4%87%E7%9F%A5%E8%AF%86"><span class="toc-number">1.</span> <span class="toc-text">
          预备知识</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">2.</span> <span class="toc-text">
          功能实现</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E7%BB%86%E8%8A%82"><span class="toc-number">3.</span> <span class="toc-text">
          代码细节</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BD%E8%B5%84%E6%BA%90"><span class="toc-number">3.1.</span> <span class="toc-text">
          加载资源</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E5%8F%98%E9%87%8F"><span class="toc-number">3.2.</span> <span class="toc-text">
          定义变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#init%E5%87%BD%E6%95%B0"><span class="toc-number">3.3.</span> <span class="toc-text">
          init函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E6%A8%A1%E5%9E%8B"><span class="toc-number">3.4.</span> <span class="toc-text">
          添加模型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#addFloor"><span class="toc-number">3.4.1.</span> <span class="toc-text">
          addFloor()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#addSheep"><span class="toc-number">3.4.2.</span> <span class="toc-text">
          addSheep()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#addDecor"><span class="toc-number">3.4.3.</span> <span class="toc-text">
          addDecor()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#addLights"><span class="toc-number">3.4.4.</span> <span class="toc-text">
          addLights()</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#run"><span class="toc-number">3.5.</span> <span class="toc-text">
          run()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E5%87%BD%E6%95%B0"><span class="toc-number">3.6.</span> <span class="toc-text">
          功能函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#jump"><span class="toc-number">3.6.1.</span> <span class="toc-text">
          jump()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#updateHead"><span class="toc-number">3.6.2.</span> <span class="toc-text">
          updateHead()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#updateFlexion"><span class="toc-number">3.6.3.</span> <span class="toc-text">
          updateFlexion()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#makeAPoo"><span class="toc-number">3.6.4.</span> <span class="toc-text">
          makeAPoo()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#updateFlying"><span class="toc-number">3.6.5.</span> <span class="toc-text">
          updateFlying()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#updateBackgroundAt-index-speed"><span class="toc-number">3.6.6.</span> <span class="toc-text">
          updateBackgroundAt(index, speed)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#reset"><span class="toc-number">3.6.7.</span> <span class="toc-text">
          reset()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#resetEyes"><span class="toc-number">3.6.8.</span> <span class="toc-text">
          resetEyes()</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6%E5%87%BD%E6%95%B0"><span class="toc-number">3.7.</span> <span class="toc-text">
          事件函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#onResize"><span class="toc-number">3.7.1.</span> <span class="toc-text">
          onResize()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#onDown"><span class="toc-number">3.7.2.</span> <span class="toc-text">
          onDown()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#onKeyDonw-e"><span class="toc-number">3.7.3.</span> <span class="toc-text">
          onKeyDonw(e)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#onUp"><span class="toc-number">3.7.4.</span> <span class="toc-text">
          onUp()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#onKeyUp-e"><span class="toc-number">3.7.5.</span> <span class="toc-text">
          onKeyUp(e)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#onMove-e"><span class="toc-number">3.7.6.</span> <span class="toc-text">
          onMove(e)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#onTouchMove-e"><span class="toc-number">3.7.7.</span> <span class="toc-text">
          onTouchMove(e)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">4.</span> <span class="toc-text">
          总结</span></a></li></ol></section><!-- ov = overview--><section class="sidebar-ov hide"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="/header.jpg" alt="avatar"></div><p class="sidebar-ov-author__text">LJY_BLOG</p></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">41</div><div class="sidebar-ov-state-item__name">Archives</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--tags" href="/tags/"><div class="sidebar-ov-state-item__count">4</div><div class="sidebar-ov-state-item__name">Tags</div></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="Creative Commons" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section><div class="sidebar-reading"><div class="sidebar-reading-info"><span class="sidebar-reading-info__text">You have read </span><span class="sidebar-reading-info__num">0</span><span class="sidebar-reading-info__perc">%</span></div><div class="sidebar-reading-line"></div></div></aside></div><div class="clearfix"></div></div></main><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script><script src="/js/utils.js?v=2.6.2"></script><script src="/js/stun-boot.js?v=2.6.2"></script><script src="/js/scroll.js?v=2.6.2"></script><script src="/js/header.js?v=2.6.2"></script><script src="/js/sidebar.js?v=2.6.2"></script></body></html>