<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/icon16.png?v=2.6.2" type="image/png" sizes="16x16"><link rel="icon" href="/favicon32.png?v=2.6.2" type="image/png" sizes="32x32"><meta name="description" content="基于Bootstrap5构建页面，使用Socket.io处理后台信息学习链接">
<meta property="og:type" content="article">
<meta property="og:title" content="Bootstrap5 &amp; Socket.io">
<meta property="og:url" content="http://example.com/2022/02/13/Bootstrap5%20&%20Socket.io/index.html">
<meta property="og:site_name" content="LJY_BLOG">
<meta property="og:description" content="基于Bootstrap5构建页面，使用Socket.io处理后台信息学习链接">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2022/02/3f1859ba254b211c.gif">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2022/02/3529737ed9312c8e.jpg">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2022/02/5608f9aea1eeda36.jpg">
<meta property="article:published_time" content="2022-02-13T07:06:30.000Z">
<meta property="article:modified_time" content="2022-02-13T14:43:25.994Z">
<meta property="article:author" content="LJY">
<meta property="article:tag" content="学习笔记">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s3.bmp.ovh/imgs/2022/02/3f1859ba254b211c.gif"><title>Bootstrap5 &amp; Socket.io | LJY_BLOG</title><link ref="canonical" href="http://example.com/2022/02/13/Bootstrap5%20&amp;%20Socket.io/"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.6.2"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  assistSearch: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: {"enable":true,"showOnPost":true,"scrollDownIcon":false},
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"default","highlight":"light","wordWrap":false},
  reward: false,
  fancybox: false,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: undefined,
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"Copy","copySuccess":"Copy Success","copyError":"Copy Error"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 5.4.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">主页</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">档案</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/tags/"><span class="header-nav-menu-item__icon"><i class="fas fa-tags"></i></span><span class="header-nav-menu-item__text">标签</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/reading/"><span class="header-nav-menu-item__icon"><i class="fas fa-book"></i></span><span class="header-nav-menu-item__text">阅读</span></a></div></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">LJY_BLOG</div><div class="header-banner-info__subtitle"></div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content" id="content"><!-- Just used to judge whether it is an article page--><div id="is-post"></div><div class="post"><header class="post-header"><h1 class="post-title">Bootstrap5 &amp; Socket.io</h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">创建</span><span class="post-meta-item__value">2022-02-13</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新</span><span class="post-meta-item__value">2022-02-13</span></span><span class="post-meta-item post-meta-item--readtime"><span class="post-meta-item__icon"><i class="far fa-clock"></i></span><span class="post-meta-item__info">阅读时间</span><span class="post-meta-item__value">17m</span></span></div></header><div class="post-body"><p>基于Bootstrap5构建页面，使用Socket.io处理后台信息<br><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1cv411K7Ti?spm_id_from=333.999.0.0">学习链接</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<span id="more"></span>


        <h1 id="预备知识">
          <a href="#预备知识" class="heading-link"><i class="fas fa-link"></i></a><a href="#预备知识" class="headerlink" title="预备知识"></a>预备知识</h1>
      <p>需要node, socket.io</p>

        <h1 id="实现细节">
          <a href="#实现细节" class="heading-link"><i class="fas fa-link"></i></a><a href="#实现细节" class="headerlink" title="实现细节"></a>实现细节</h1>
      <p>完成样子。</p>
<p><img src="https://s3.bmp.ovh/imgs/2022/02/3f1859ba254b211c.gif" alt="03"></p>

        <h2 id="服务端">
          <a href="#服务端" class="heading-link"><i class="fas fa-link"></i></a><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h2>
      <p>npm init - 得到package.json<br>修改package.json<br><code>"main": "index.js",</code> -&gt; <code>"main": "server.js"</code></p>
<p>npm i express socket.io - 安装包,主角登场</p>
<p>npm i nodemon –save-dev - 测试环境安装</p>
<ul>
<li>安装 - 可服务热加载 - 不需要手动重启服务，用nodemon</li>
</ul>
<p>修改scripts - 执行命令</p>
<figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">"scripts": {</span><br><span class="line">  "dev":"nodemon server.js"</span><br><span class="line">},</span><br></pre></td></tr></tbody></table></div></figure>

<p>创建server.js<br>把所有前端文件，放入public文件！</p>
<p>可以开始后端代码了！</p>
<figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">const express = require('express'); // 引入资源</span><br><span class="line">const socketio = require('socket.io');</span><br><span class="line"></span><br><span class="line">const app = express(); // 创建实例</span><br><span class="line"></span><br><span class="line">const PORT = process.env.PORT || 9527; // 定义端口</span><br><span class="line"></span><br><span class="line">app.listen(PORT, () =&gt; { // 测试链接</span><br><span class="line">	console.log('This server is running on port' + PORT)</span><br><span class="line">})</span><br><span class="line"></span><br></pre></td></tr></tbody></table></div></figure>

<p>输入npm run dev</p>
<p>可以看到<br><img src="https://s3.bmp.ovh/imgs/2022/02/3529737ed9312c8e.jpg" alt="01"></p>
<p>引入静态资源 - 可以看到页面了！</p>
<figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const path = require('path'); </span><br><span class="line"></span><br><span class="line">app.use(express.static(path.join(__dirname, 'public')));</span><br></pre></td></tr></tbody></table></div></figure>

<p><img src="https://s3.bmp.ovh/imgs/2022/02/5608f9aea1eeda36.jpg" alt="02"></p>
<p>引入http服务，创建http对象，用socket来接收,用server来监听！</p>
<p>所以app - express做了什么？？？use。。。引入静态资源。</p>
<figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const http = require('http'); // 挂载socketio</span><br><span class="line"></span><br><span class="line">const app = express();</span><br><span class="line">const server = http.createServer(app); // 手动创建http对象</span><br><span class="line"></span><br><span class="line">const io = socketio(server); // 把http服务挂载到io</span><br><span class="line"></span><br><span class="line">server.listen(PORT, () =&gt; {</span><br><span class="line">	console.log('This server is running on port ' + PORT)</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></div></figure>

<p>可以访问以下路径了，socketio把客户端文件挂载到服务器上了！<br><code>http://localhost:9527/socket.io/socket.io.js</code></p>
<p>监听/发送</p>
<figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 监听,有没有连进来。</span><br><span class="line">io.on('connection', (socket) =&gt; {</span><br><span class="line">	io.emit('sysMessage', '欢迎加入聊天室') // 发送</span><br><span class="line">})</span><br><span class="line"></span><br></pre></td></tr></tbody></table></div></figure>


<p>在静态页内引入js - chat.html</p>
<figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 来自socket.io</span><br><span class="line">&lt;script src="/socket.io/socket.io.js" type="text/javascript" charset="utf-8"&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">// public下新建一个</span><br><span class="line">&lt;script src="./main.js" type="text/javascript" charset="utf-8"&gt;&lt;/script&gt;</span><br></pre></td></tr></tbody></table></div></figure>

<p>在main.js中写入<br><code>const socket = io();</code> </p>
<p>就可以连接上socket服务了！<br>访问<span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="http://localhost:9527/chat.html">http://localhost:9527/chat.html</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span><br>查看network，有ws标签，可以看到socket.io.js已经有了！</p>
<p>main.js继续写, 刷新chat.html页面，就可以看到数据了！ - ‘欢迎加入聊天室’</p>
<figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">socket.on('sysMessage', (message) =&gt; {</span><br><span class="line">	console.log(message)</span><br><span class="line">})</span><br><span class="line"></span><br><span class="line">socket.emit('chatMessage', 'Hi'); // 发送给服务器！</span><br></pre></td></tr></tbody></table></div></figure>

<p>server.js</p>
<figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// 监听,有没有连进来。</span><br><span class="line">io.on('connection', (socket) =&gt; {</span><br><span class="line">	socket.emit('sysMessage', '欢迎加入聊天室');</span><br><span class="line">	</span><br><span class="line">	// 这里打印在ide里面,应该在浏览器里面</span><br><span class="line">	// 把接收到的信息,再发送出去!</span><br><span class="line">	// socket.on('chatMessage', message =&gt; console.log(message)); // 接收 main.js发送的数据</span><br><span class="line">	</span><br><span class="line">	socket.on('chatMessage', message =&gt;  {</span><br><span class="line">		//socket.emit('chatMessage', message) // 这里要改成 io来发送 - io全局对象!!</span><br><span class="line">		</span><br><span class="line">		// 开两个chat.html,一个刷新,另一个就能显示出来了!!!</span><br><span class="line">		io.emit('chatMessage', message) // 这里要改成 io来发送 - io全局对象!!</span><br><span class="line">		</span><br><span class="line">	});</span><br><span class="line">})</span><br><span class="line"></span><br></pre></td></tr></tbody></table></div></figure>

<p>main.js里面监听 - 发送的信息..</p>
<figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">const socket = io();</span><br><span class="line"></span><br><span class="line">socket.on('sysMessage', (message) =&gt; {</span><br><span class="line">	console.log(message)</span><br><span class="line">})</span><br><span class="line"></span><br><span class="line">socket.emit('chatMessage', 'Hi');</span><br><span class="line"></span><br><span class="line">socket.on('chatMessage', message =&gt; { // 这里是由服务器返回的.</span><br><span class="line">	console.log(message)</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></div></figure>



<hr>
<p>这里添加html内容.<br>在chat.html里面,用form套住输入信息.</p>
<p>id=’chat-form’ // 找到位置 - 提交操作<br>id=’msg’ // 获取输入信息 - 发送出去.</p>
<figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action="#" id='chat-form'&gt;</span><br><span class="line">	&lt;div class="input-group mb-3"&gt;</span><br><span class="line">		&lt;input id='msg' type="text" class="form-control" placeholder="请输入消息"&gt;</span><br><span class="line">		&lt;button class="btn btn-success"&gt;&lt;i class="bi bi-send"&gt;&lt;/i&gt;&amp;nbsp;发送&lt;/button&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></tbody></table></div></figure>


<p>main.js - 发送消息,用的 chatMessage, 事件.</p>
<figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">document.getElementById('chat-form').addEventListener('submit', e =&gt; {</span><br><span class="line">	e.preventDefault(); //组织默认提交事件.</span><br><span class="line">	</span><br><span class="line">	socket.emit('chatMessage', document.getElementById('msg').value); </span><br><span class="line">})</span><br></pre></td></tr></tbody></table></div></figure>

<p>已经可以发送消息了.<br>现在,把信息显示在UI框架上面!<br><code>&lt;div class="col-sm-12 col-md-8 message-container"&gt;</code> 在容器上添加类,写入信息 - 做加法!</p>
<p>main.js - 已经可以发送到UI框架了!,,,  渐渐忘了 on监听的是什么了…..</p>
<figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">socket.on('chatMessage', message =&gt; {</span><br><span class="line">	// console.log(message)</span><br><span class="line">	document.querySelector('.message-container').innerHTML += </span><br><span class="line">		`&lt;div class="d-flex justify-content-end my-3"&gt;</span><br><span class="line">			&lt;div class="card w-30 bg-success text-light"&gt;</span><br><span class="line">				&lt;div class="card-body"&gt;${message}&lt;/div&gt;</span><br><span class="line">			&lt;/div&gt;</span><br><span class="line">		&lt;/div&gt;`</span><br><span class="line">});</span><br><span class="line"></span><br></pre></td></tr></tbody></table></div></figure>


<p>如何区分发送的是谁? - 已经可以发送人名了<br>用对象的形式发送,<br>{name: ‘’, content: ‘’};</p>
<figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">const name = 'John'</span><br><span class="line"></span><br><span class="line">document.getElementById('chat-form').addEventListener('submit', e =&gt; {</span><br><span class="line">	e.preventDefault(); //组织默认提交事件.</span><br><span class="line"></span><br><span class="line">	// socket.emit('chatMessage', document.getElementById('msg').value); </span><br><span class="line">	socket.emit('chatMessage', {</span><br><span class="line">			name,</span><br><span class="line">			content: document.getElementById('msg').value</span><br><span class="line">	});</span><br><span class="line">})</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">document.querySelector('.message-container').innerHTML +=</span><br><span class="line">`&lt;div class="d-flex justify-content-end my-3"&gt;</span><br><span class="line">		&lt;div class="card w-30 bg-success text-light"&gt;</span><br><span class="line">			&lt;div class="card-body"&gt;</span><br><span class="line">				&lt;div class='card-title'&gt;${message.name}&lt;/div&gt;</span><br><span class="line">				&lt;div class='card-text'&gt;${message.content}&lt;/div&gt;</span><br><span class="line">			&lt;/div&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">	&lt;/div&gt;`</span><br><span class="line"></span><br></pre></td></tr></tbody></table></div></figure>

<p>如何动态获取姓名?<br>通过url</p>
<p>这里引入qs 插件 - 写入chat.html里面<br><code>&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/qs/6.10.3/qs.min.js"&gt;&lt;/script&gt;</code></p>
<p>main.js里面 - 可以获取到url的信息了!</p>
<figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 如果没有{ignoreQueryPrefix: true},会多一个问号</span><br><span class="line">// url - ?name=John</span><br><span class="line">const params = Qs.parse(location.search, {ignoreQueryPrefix: true})</span><br><span class="line"></span><br><span class="line">console.log(params)//打印{name:'John'}</span><br></pre></td></tr></tbody></table></div></figure>


<p>如何知道是不是自己发送的?<br>在发送的时候判断!<br>判断接收到的和url是不是一样 - 我发送出去的发送给自己 - 接收。</p>
<figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">const isMine = message.name === name;</span><br><span class="line">	</span><br><span class="line">document.querySelector('.message-container').innerHTML +=</span><br><span class="line">	`&lt;div class="d-flex ${isMine ? 'justify-content-end' : 'justify-content-start'} my-3"&gt;</span><br><span class="line">			&lt;div class="card w-30 ${isMine ? 'bg-success text-light' : 'text-dark'} "&gt;</span><br><span class="line">				&lt;div class="card-body"&gt;</span><br><span class="line">					&lt;div class='card-title'&gt;${isMine ? '我' : message.name}&lt;/div&gt;</span><br><span class="line">					&lt;div class='card-text'&gt;${message.content}&lt;/div&gt;</span><br><span class="line">				&lt;/div&gt;</span><br><span class="line">			&lt;/div&gt;</span><br><span class="line">		&lt;/div&gt;`</span><br></pre></td></tr></tbody></table></div></figure>


<p>如何处理用户列表？</p>
<p>定义一个user.js, 在server.js中导入。</p>
<figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">const users = [];</span><br><span class="line"></span><br><span class="line">function userJoin(id, name, room) { // 加入用户列表</span><br><span class="line">	const user = {id, name, room};</span><br><span class="line">	users.push(user);</span><br><span class="line">	return user;</span><br><span class="line">}</span><br><span class="line">function getRoomUsers(room) { // 返回在同一个房间的用户。</span><br><span class="line">	return users.filter(user =&gt; user.room === room);</span><br><span class="line">}</span><br><span class="line">module.exports = {</span><br><span class="line">	userJoin,</span><br><span class="line">	getRoomUsers</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></div></figure>


<p>main.js</p>
<figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const name = params.name</span><br><span class="line">const room = params.room</span><br><span class="line"></span><br><span class="line">socket.emit('joinRoom', {name, room}) // 发送</span><br><span class="line"></span><br><span class="line">socket.on('roomUsers', userList =&gt; { // 接收当前房间的用户。</span><br><span class="line">	console.log(userList)</span><br><span class="line">})</span><br><span class="line"></span><br></pre></td></tr></tbody></table></div></figure>

<p>server.js</p>
<figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">const {getRoomUsers, userJoin} = require('./user')</span><br><span class="line"></span><br><span class="line">// 监听,有没有连进来。</span><br><span class="line">io.on('connection', (socket) =&gt; {</span><br><span class="line">	</span><br><span class="line">	socket.on('joinRoom', ({name, room}) =&gt; {</span><br><span class="line">		// 加入房间？？？</span><br><span class="line">		socket.join(room);</span><br><span class="line">		</span><br><span class="line">		userJoin(socket.id, name, room); // 把user加入users。。加入用户列表</span><br><span class="line">		</span><br><span class="line">		// 全局变量，发送给当前room</span><br><span class="line">		io.to(room).emit('roomUsers', getRoomUsers(room)) // 发送用户列表给客户端</span><br><span class="line">		</span><br><span class="line">		socket.to(room).emit('sysMessage', '欢迎加入聊天室');</span><br><span class="line">		</span><br><span class="line">		socket.on('chatMessage', message =&gt; {</span><br><span class="line">			// 这个全局io 很重要...</span><br><span class="line">			io.to(root).emit('chatMessage', message); </span><br><span class="line">			}</span><br><span class="line">		);</span><br><span class="line">	})</span><br><span class="line"></span><br><span class="line">})</span><br></pre></td></tr></tbody></table></div></figure>


<p>可以获取用户列表了，问题是刷新后，用户会再次加入 - 重复<br>因为刷新后，断开连接，又连接一次。</p>
<figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">user.js</span><br><span class="line"></span><br><span class="line">//删除用户</span><br><span class="line">function userLeave(id) {</span><br><span class="line">	const index = users.findIndex(user =&gt; user.id === id);</span><br><span class="line">	</span><br><span class="line">	if(index !== -1) {</span><br><span class="line">		return users.splice(index, 1)[0];</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line">module.exports = {</span><br><span class="line">	userJoin,</span><br><span class="line">	getRoomUsers,</span><br><span class="line">	userLeave</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">-------------</span><br><span class="line"></span><br><span class="line">server.js</span><br><span class="line"></span><br><span class="line">// 监听系统事件。</span><br><span class="line">socket.on('disconnect', () =&gt; {</span><br><span class="line">	</span><br><span class="line">	userLeave(socket.id);</span><br><span class="line">	</span><br><span class="line">	// 重新发送一份用户列表</span><br><span class="line">	io.to(room).emit('roomUsers', getRoomUsers(room)) // // 发送用户列表给客户端</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></div></figure>

<p>获取了用户列表 - 写入页面！</p>
<figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">socket.on('roomUsers', userList =&gt; {</span><br><span class="line">	// console.log(userList)</span><br><span class="line">	const userListEl = document.querySelector('.user-list'); // ul的字段，写li进去</span><br><span class="line">	</span><br><span class="line">	let listHtml = '';</span><br><span class="line">	userList.map(user =&gt; {</span><br><span class="line">		listHtml += `&lt;li class='list-group-item'&gt;${user.name}&lt;/li&gt;'`</span><br><span class="line">	})</span><br><span class="line">	</span><br><span class="line">	// 加入之前先清空</span><br><span class="line">	while(userListEl.childNodes.length &gt; 3) {</span><br><span class="line">		userListEl.removeChild(userListEl.lastChild);</span><br><span class="line">	}</span><br><span class="line">	</span><br><span class="line">	userListEl.innerHTML += listHtml;</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></div></figure>

<p>填写房间名称 - 可以用列表</p>
<figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const room = params.room</span><br><span class="line">// room名称</span><br><span class="line">document.querySelector('.room-name').innerHTML = room;</span><br><span class="line"></span><br><span class="line">如果换个room，bob也会走。</span><br><span class="line"></span><br></pre></td></tr></tbody></table></div></figure>


<p>细节优化！<br>输入信息，不可输入空信息，发送后，信息框为空</p>
<figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// socket.emit('chatMessage', document.getElementById('msg').value);</span><br><span class="line"> const msgEl = document.getElementById('msg')</span><br><span class="line"> </span><br><span class="line"> if(msgEl.value === '') {</span><br><span class="line">	 alert('请输入信息');</span><br><span class="line">	 return;</span><br><span class="line"> }</span><br><span class="line">socket.emit('chatMessage', {</span><br><span class="line">		name,</span><br><span class="line">		content: msgEl.value</span><br><span class="line">});</span><br><span class="line">msgEl.value = ''; // 发送完，消息设置为空</span><br><span class="line"></span><br></pre></td></tr></tbody></table></div></figure>


<p>输入信息，滚动条应该在最下面！</p>
<figure class="highlight plain"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">const scroll = function() {</span><br><span class="line">	const rightPanel = document.querySelector('.right-panel'); // 最外层</span><br><span class="line">	const messageContainer = document.querySelector('.message-container'); // 信息区域</span><br><span class="line">	</span><br><span class="line">	//scrollTop() 方法设置或返回被选元素的垂直滚动条位置。</span><br><span class="line">	// scrollHeight - 整体的高度！</span><br><span class="line">	</span><br><span class="line">	rightPanel.scrollTop = messageContainer.scrollHeight; // 到底了</span><br><span class="line">	</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">在发送信息的时候，调用scroll</span><br></pre></td></tr></tbody></table></div></figure>


<p>最后 - index.html<br>传递参数 - name / room</p>
<p>加个form, action - 指定跳转，method - 写入url！<br><code>&lt;form action="chat.html" method="get"&gt;</code></p>
<p>给input指定name - name<br>给select指定name - room</p>
<p>完结！！！</p>
<p>还有任务：<br>进入页面 - 显示欢迎 **<br>可以在聊天室切换房间！ ** 如何切换房间？？？<br>dom 元素什么时候获取？？<br>server.js - 服务端 - 负责转发通信<br>main.js - 客户端 - 负责处理页面？？？</p>

        <h1 id="总结">
          <a href="#总结" class="heading-link"><i class="fas fa-link"></i></a><a href="#总结" class="headerlink" title="总结"></a>总结</h1>
      <p>Bootstrap构建页面，慢慢体会到好处了！</p>
<p>express - 开启服务，连接静态资源<br>http - 结合socket.io<br>socket.io - 转发通信<br>path - 处理本地资源</p>
<p>nodemon - 热加载 - 开发模式</p>
<p>socket.io，负责转发通信。有全局通信和局部通信之分。<br>主要通过on 和emit来触发，用回调函数传递信息。<br>步骤：</p>
<ol>
<li>构建页面 - Bootstrap</li>
<li>建立连接 - express  http + socket.io  path</li>
<li>转发信息 - on emit</li>
<li>用js写入dom - innerHTML + 字符串拼接</li>
<li>创建user.js 来处理用户信息的资源获取与修改。</li>
</ol>

        <h1 id="补充资料">
          <a href="#补充资料" class="heading-link"><i class="fas fa-link"></i></a><a href="#补充资料" class="headerlink" title="补充资料"></a>补充资料</h1>
      <p>构建即时聊天计数</p>
<ul>
<li>长连接 - 占用资源，一条通信线路一直开着</li>
<li>轮询 - 请求量大，占用资源</li>
<li>websocket - 客户端可向服务器发起请求，消耗资源小</li>
</ul>
<p>network中查看socket 有id - 获取它 - 唯一性。</p>
</div><footer class="post-footer"><div class="post-ending ending"><div class="ending__text">------ END ------</div></div><div class="post-tags"><span class="post-tags-item"><span class="post-tags-item__icon"><i class="fas fa-tag"></i></span><a class="post-tags-item__link" href="http://example.com/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a></span></div><div class="post-share"><div class="social-share" data-sites="qzone, qq, weibo, wechat, douban, linkedin, facebook, twitter, google">Share to: </div></div><nav class="post-paginator paginator"><div class="paginator-prev"><a class="paginator-prev__link" href="/2022/02/14/Bootstrap5%20&amp;%20Vue3.0/"><span class="paginator-prev__icon"><i class="fas fa-angle-left"></i></span><span class="paginator-prev__text">Bootstrap5 &amp; Vue3.0</span></a></div><div class="paginator-next"><a class="paginator-next__link" href="/2022/02/13/Bootstrap5%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"><span class="paginator-prev__text">Bootstrap5快速入门</span><span class="paginator-next__icon"><i class="fas fa-angle-right"></i></span></a></div></nav></footer></div></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><div class="sidebar-nav"><span class="sidebar-nav-toc current">Catalog</span><span class="sidebar-nav-ov">Overview</span></div><section class="sidebar-toc"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A2%84%E5%A4%87%E7%9F%A5%E8%AF%86"><span class="toc-number">1.</span> <span class="toc-text">
          预备知识</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E7%BB%86%E8%8A%82"><span class="toc-number">2.</span> <span class="toc-text">
          实现细节</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="toc-number">2.1.</span> <span class="toc-text">
          服务端</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">3.</span> <span class="toc-text">
          总结</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A1%A5%E5%85%85%E8%B5%84%E6%96%99"><span class="toc-number">4.</span> <span class="toc-text">
          补充资料</span></a></li></ol></section><!-- ov = overview--><section class="sidebar-ov hide"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="/header.jpg" alt="avatar"></div><p class="sidebar-ov-author__text">LJY_BLOG</p></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">32</div><div class="sidebar-ov-state-item__name">Archives</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--tags" href="/tags/"><div class="sidebar-ov-state-item__count">4</div><div class="sidebar-ov-state-item__name">Tags</div></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="Creative Commons" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section><div class="sidebar-reading"><div class="sidebar-reading-info"><span class="sidebar-reading-info__text">You have read </span><span class="sidebar-reading-info__num">0</span><span class="sidebar-reading-info__perc">%</span></div><div class="sidebar-reading-line"></div></div></aside></div><div class="clearfix"></div></div></main><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script><script src="/js/utils.js?v=2.6.2"></script><script src="/js/stun-boot.js?v=2.6.2"></script><script src="/js/scroll.js?v=2.6.2"></script><script src="/js/header.js?v=2.6.2"></script><script src="/js/sidebar.js?v=2.6.2"></script></body></html>